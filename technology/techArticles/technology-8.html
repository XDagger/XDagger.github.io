<!DOCTYPE html>
<html>

<head>
    
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
<meta name="keywords" content=""/>
<meta name="description" content=""/>
<meta name="author" content=""/>
<link rel="shortcut icon" href="/assets/images/favicon.png" type="image/x-icon">
<title>XDAG | A new DAG-based cryptocurrency</title>

<!-- bootstrap core css -->
<link rel="stylesheet" type="text/css" href="/assets/css/bootstrap.css"/>

<!-- fonts style -->
<link href="/assets/css/poppins.css" rel="stylesheet">

<!-- font awesome style -->
<link href="/assets/css/font-awesome.min.css" rel="stylesheet"/>

<!-- Custom styles for this template -->
<link href="/assets/css/style.css" rel="stylesheet"/>
<!-- responsive style -->
<link href="/assets/css/responsive.css" rel="stylesheet"/>
<!--    <link href="css/timeline.css" rel="stylesheet"/>-->
<link href="/assets/css/home.css" rel="stylesheet"/>
<link href="/assets/lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet"/>

</head>

<body class="sub_page">
<div class="hero_area">
    <div class="hero_bg_box">
        <img src="/assets/images/img4.jpg" alt="">
    </div>
    <!-- header section strats -->
    <header class="header_section">
        <div class="container">
            <div class="container">
    <nav class="navbar navbar-expand-lg custom_nav-container ">
        <a class="navbar-brand " href="index.html">
            <span>
              <img src="/assets/images/logo.png" alt="" class="logo">
            </span>
        </a>

        <button class="navbar-toggler" type="button" data-toggle="collapse"
                data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                aria-expanded="false" aria-label="Toggle navigation">
            <span class=""> </span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav">
                <li class="nav-item active">
                    <a class="nav-link" href="/">Home <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-expanded="false">
                        Block Explorer
                    </a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <a class="dropdown-item" href="http://explorer.xdag.io/" target="_blank">Main net</a>
                        <a class="dropdown-item" href="https://testexplorer.xdag.io/" target="_blank">Test net</a>
                    </div>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="Resources" role="button" data-toggle="dropdown" aria-expanded="false">
                        Resources
                    </a>
                    <div class="dropdown-menu" aria-labelledby="Resources">
                        <a class="dropdown-item" href="https://github.com/XDagger/xdag/blob/master/WhitePaper.md" target="_blank">Whitepaper</a>
                        <a class="dropdown-item" href="https://github.com/XDagger/xdagj/releases" target="_blank">Releases</a>
                        <a class="dropdown-item" href="/index.html#roadmap">Roadmap</a>
                    </div>
                </li>

                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="Announcements" role="button" data-toggle="dropdown" aria-expanded="false">
                        Announcements
                    </a>
                    <div class="dropdown-menu" aria-labelledby="Announcements">
<!--                        <a class="dropdown-item" href="https://medium.com/@XDAG_Community" target="_blank">News</a>-->
                        <a class="dropdown-item" href="https://medium.com/tag/xdag" target="_blank">News</a>
                        <a class="dropdown-item" href="/technology">Article</a>
                        <a class="dropdown-item" href="/video">Video</a>

                    </div>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="Community" role="button" data-toggle="dropdown" aria-expanded="false">
                        Community
                    </a>
                    <div class="dropdown-menu" aria-labelledby="Community">
<!--                        <a class="dropdown-item" href="/rank">Wallet Rank</a>-->
                        <a class="dropdown-item" href="https://xdag.site" target="_blank">Wallet Rank</a>
                        <a class="dropdown-item" href="/task">Reward Tasks</a>
                        <a class="dropdown-item" href="/hashrate">Hashrate Statistics</a>
                        <a class="dropdown-item" href="https://xdag.notion.site/xdag/XDAG-How-to-by-FSOL-776d59789d26456c9f69633c398fbbd2" target="_blank">FAQ</a>
                    </div>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="Exchanges" role="button" data-toggle="dropdown" aria-expanded="false">
                        Exchanges
                    </a>
                    <div class="dropdown-menu" aria-labelledby="Exchanges">
<!--                        <a class="dropdown-item" href="https://www.coinex.com/exchange/XDAG-USDT" target="_blank">Coinex </a>-->
                        <a class="dropdown-item" href="https://www.xt.com/en/trade/xdag_usdt" target="_blank">XT</a>
                        <a class="dropdown-item" href="https://www.mexc.com/exchange/XDAG_USDT" target="_blank">MEXC</a>
<!--                        <a class="dropdown-item" href="https://www.uubiter.com/spot/#/index/xdag_usdt" target="_blank">UUBiter</a>-->
<!--                        <a class="dropdown-item" href="https://bikingex.com/spot/trade-spot/XDAG_USDT" target="_blank">BiKing</a>-->
                        <a class="dropdown-item" href="https://uzx.com/#/exchange/xdag_usdt" target="_blank">UZX</a>
                        <a class="dropdown-item" href="https://nonkyc.io/asset/XDAG" target="_blank">NonKYC</a>
                        <a class="dropdown-item" href="https://www.bit.com/spot?pair=XDAG-USDT" target="_blank">BIT</a>
<!--                        <a class="dropdown-item" href="https://xeggex.com/market/XDAG_USDT" target="_blank">XeggeX</a>-->
<!--                        <a class="dropdown-item" href="https://p2pb2b.com/trade/XDAG_BUSD" target="_blank">P2B</a>-->
                        <a class="dropdown-item" href="https://azbit.com/exchange/XDAG_USDT" target="_blank">Azbit</a>
<!--                        <a class="dropdown-item" href="https://hoo.com/innovation/xdag-usdt" target="_blank">HOO </a>-->
                    </div>
                </li>

            </ul>
        </div>
    </nav>
</div>

        </div>
    </header>
    <!-- end header section -->
</div>



<div class="blog-details-area padding-top-120 padding-bottom-90">
    <div class="s-shape1 "></div>
    <div class="s-shape2"></div>
    <div class="container">
        <div class="row">
            <div class="col-lg-8">
                <!-- single-blog-post-item -->
                <article class="single-blog-list-item mb-30">
                    <div class="blog-details">
                        <div class="blog-title mt-20">
                            <h2>XDAG技术详解8-文件存储结构</h2>
                        </div>
                        <div class="blog-meta border-0 mt-0 pt-1 pb-15">
                            <span class="mr-0 border-0"><i class="fa fa-calendar"></i> 2020-01-04</span>
                        </div>
                        <div class="blog-content">
                            <h1 id="xdag技术详解8-文件存储结构">XDAG技术详解8-文件存储结构</h1>

<p>作者：社区成员Larry</p>

<h2 id="时间格式">时间格式</h2>

<p>因为xdag的文件存储命名使用了时间戳，需要先描述时间戳的格式。</p>

<p>时间戳</p>

<p>xdag用的时间戳是一个64位的int值，分为两部分。</p>

<p>尾部低10位</p>

<p>表示秒以下的单位，最小单位是1/1024秒，注意作者在这里用的是二进制运算，所以用1024去分割秒。</p>

<p>剩余的高54位</p>

<p>UTC秒。注意，实际中用不到54位。</p>

<p>时间片</p>

<p>xdag用64秒做为一个时间片，假设t为时间戳，则 t»16 (先右移10位去秒，再右移4位) 为时间片序号，代码中每次取时间片都是用这种方式。</p>

<h2 id="storage目录结构">storage目录结构</h2>

<p>一个典型的存储目录结构：</p>

<p><img src="../images/WechatIMG1352.png" alt="图片1" /></p>

<p>文件命名</p>

<p>除了0级目录名固定为storage外，1到3级目录和block文件的命名均与时间戳有关。</p>

<p>假设一个block的时间戳16进制为：XX1-XX2-XX3-XX4-XX5-XX6-XX7-XX8，则这个block会被存储在名为storage/XX1XX2XX3/XX4/XX5/XX6.dat的文件中，因为通常XX1XX2都是0（目前秒的部分只需要32位就够了，而这里实际有54位），所以我们看到的实际文件名路径一般为storage/XX3/XX4/XX5/XX6.dat，但是注意，随着时间的推移，1级目录名出现XX1XX2XX3的形式是正确的。<strong><em>*但在目前的代码实现上，只允许出现XX3，不允许出现XX1XX2XX3，所以后续都假设只有XX3一种形式*</em></strong>。</p>

<p>目录存储</p>

<p>因为文件名的命名用的是一个字节的16进制字符表示，所以理论上，任何一个目录下的子目录或者文件个数，最多只能有256个。文件名反映了对上级时间段的256分割。</p>

<p>3级目录下的block文件，最多可以有256个，每个文件包含了一个时间片内所有的block存储（64秒内）。</p>

<p>1、2、3级目录中的目录数，也是只能最多256个。</p>

<p>0级目录只有固定的一个storage。</p>

<h2 id="block文件结构">block文件结构</h2>

<p>一个block文件（XX6.dat），存储了一个XX6时间片（64秒）内所有收到的block，按顺序把二进制放进去，个数不限，理论上这个文件可以无限大（除了受到文件系统限制）。</p>

<table>
  <tbody>
    <tr>
      <td>格式：block1-struct-binary</td>
      <td>block2-struct-binary</td>
      <td>…</td>
      <td>blockN-struct-binary。</td>
    </tr>
  </tbody>
</table>

<h2 id="sums文件">sums文件</h2>

<p>sums文件格式</p>

<p>sums.dat存储了当前目录下所有block（或者目录）的数据摘要结果。</p>

<p>sum文件固定为4K大小，文件被等分为256个部分，存储当前目录下256个文件（目录）各自的sum计算结果。每个等分16字节，等于struct xdag_storage_sum的大小。</p>

<p><strong><em>*struct*</em></strong> xdag_storage_sum {
  uint64_t sum;  <strong>// 8字节</strong>
  uint64_t size;  <strong>// 8字节</strong>
};</p>

<p>每个block（目录）在sum在文件中的存储索引，就是block文件名的值（转为十进制后）。</p>

<p>拿9d/sums.dat文件举例，这个文件的第138等分处，存储的是9d/8a.dat文件的sum计算结果（直接存储了xdag_storage_sum结构体），因为16进制的8a等于十进制的138。</p>

<p>sum计算方式</p>

<p>每个位置实际存储的就是xdag<strong>storage</strong>sum结构体的二进制内容，下面说明如何计算。</p>

<p>以9d/8a.dat文件的sum计算举例，在9d/sums.dat文件的第138个位置，存储了一个下面的结构体。</p>

<p><strong><em>*struct*</em></strong> xdag_storage_sum {
  uint64_t sum;
  uint64_t size;
};</p>

<p>size：8a.dat文件中所有block的字节总和，实际上就是文件大小，之所以这样描述，是因为代码是这样写的，这是直观意图，但不排除未来这两者不再相等。</p>

<p>sum：把block文件按照8字节分割，每个8字节作为一个64位int叠加到sum，原始代码：s.sum += ((uint64_t *)(buf + i))[j];。这里的目的是为了做摘要后在多结点间对比数据差异，碰撞概率上比hash大，有一定瑕疵。</p>

<p>1/2/3级目录sum计算</p>

<p>以3级目录举例，3级目录中sums.dat文件中的存储结构与block目录的sums.dat文件存储模式一致，只不过把block的位置换成了目录的位置。</p>

<p>以9d目录举例，则6c/sums.dat文件中的第157位置存储的是9d目录的sum结果，因为16进制9d等于十进制157。</p>

<p>9d目录的xdag<strong>storage</strong>sum结构体计算方法比较简单，就是把9d/sums.dat中256个xdag<strong>storage</strong>sum结构体的相同字段简单求和。9d-xdag<strong>storage</strong>sum.size = sum(9d/sums.dat.size)，sum字段类似。</p>

<p>1、2级目录的sum计算方法一样。</p>

                        </div>

                    </div>
                </article>
            </div>
            <div class="col-lg-4">
                <aside class="widgets-area">

                    <div class="widget widget-search mb-40">
                        <h4 class="title">Search Here</h4>
                        <div class="single-search-inner">
                            <input type="text" placeholder="Search here...">
                            <button><i class="fa fa-search" aria-hidden="true"></i></button>
                        </div>
                    </div>


                </aside>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="qq"  tabindex="-1" >
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">

            <div class="modal-body">
                <div class="qqBg">
                    <dl>
                        <dt><img src="/assets/images/qqQrcode.png" alt=""></dt>
                        <dd>QQ Group</dd>
                    </dl>

                </div>
            </div>

        </div>
    </div>
</div>
<div class="modal fade" id="wechat"  tabindex="-1" >
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content" style="background: none;border: 0">

            <div class="modal-body" style="display: flex;justify-content: center">
                <div class="qqBg">
                    <dl>
                        <dt><img src="/assets/images/wechat.jpg" alt=""></dt>
                    </dl>

                </div>
            </div>

        </div>
    </div>
</div>
<div class="modal fade" id="weibo"  tabindex="-1" >
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body">
                <div class="qqBg">
                    <dl>
                        <dt><img src="/assets/images/weibo.jpg" alt=""></dt>
                        <dd>Weibo</dd>
                    </dl>

                </div>
            </div>

        </div>
    </div>
</div>
<section class="info_section ">

    <div class="container">
        <div class="info_top ">
            <div class="row ">
                <div class="col-md-7 col-lg-8">
                    <div class="info_detail">
                        <a href="index.html">
                            <h4>
                                XDAG
                            </h4>
                        </a>
                        <p>
                            Support The Community: This site is managed by the XDAG community.
                        </p>
                        <ul class="community_wallets">
                            <li>
                                <p class="community_wallets__item">
                                    <i class="fa fa-check"></i>
                                    <span class="community_wallets__currency">XDAG</span>
                                    <span class="community_wallets__address">PKcBtHWDSnAWfZntqWPBLedqBShuKSTzS</span>
                                    <i class="fa fa-copy" onclick="copyAddress('PKcBtHWDSnAWfZntqWPBLedqBShuKSTzS')" data-toggle="tooltip" data-placement="top" title="Address copied to Clipboard" data-trigger="click"></i>
                                </p>
                            </li>

                            <li>
                                <p class="community_wallets__item">
                                    <i class="fa fa-check"></i>
                                    <span class="community_wallets__currency">USDT(TRC-20)</span>
                                    <span class="community_wallets__address">TMYxojZJWKBwqf9sKg8gJeqX1cghzZWpu7</span>
                                    <i class="fa fa-copy" onclick="copyAddress('TMYxojZJWKBwqf9sKg8gJeqX1cghzZWpu7')"  data-toggle="tooltip" data-placement="top" title="Address copied to Clipboard" data-trigger="click"></i>
                                </p>
                            </li>

<!--                            <li>-->
<!--                                <p class="community_wallets__item">-->
<!--                                    <i class="fa fa-check"></i>-->
<!--                                    <span class="community_wallets__currency">ETH</span>-->
<!--                                    <span class="community_wallets__address">0xb5F34fEb083186AfcB1DB1eFdE41eDA1f9BD9fB1</span>-->
<!--                                    <i class="fa fa-copy" onclick="copyAddress('0xb5F34fEb083186AfcB1DB1eFdE41eDA1f9BD9fB1')"  data-toggle="tooltip" data-placement="top" title="Address copied to Clipboard" data-trigger="click"></i>-->
<!--                                </p>-->
<!--                            </li>-->

                        </ul>

                    </div>
                </div>
                <div class="col-md-5 col-lg-4 col-xl-3 mx-auto">
                    <h4>
                        Contact us
                    </h4>
                    <p>
                        You can find us in the following channels
                    </p>

                    <div class="social_box">
                        <a href="https://discord.gg/YxXUVQJ" class="discord" target="_blank">
                            <svg xmlns="http://www.w3.org/2000/svg" width="71" height="55" viewBox="0 0 71 55" fill="none"><script xmlns=""/>
                                <g clip-path="url(#clip0)">
                                    <path d="M60.1045 4.8978C55.5792 2.8214 50.7265 1.2916 45.6527 0.41542C45.5603 0.39851 45.468 0.440769 45.4204 0.525289C44.7963 1.6353 44.105 3.0834 43.6209 4.2216C38.1637 3.4046 32.7345 3.4046 27.3892 4.2216C26.905 3.0581 26.1886 1.6353 25.5617 0.525289C25.5141 0.443589 25.4218 0.40133 25.3294 0.41542C20.2584 1.2888 15.4057 2.8186 10.8776 4.8978C10.8384 4.9147 10.8048 4.9429 10.7825 4.9795C1.57795 18.7309 -0.943561 32.1443 0.293408 45.3914C0.299005 45.4562 0.335386 45.5182 0.385761 45.5576C6.45866 50.0174 12.3413 52.7249 18.1147 54.5195C18.2071 54.5477 18.305 54.5139 18.3638 54.4378C19.7295 52.5728 20.9469 50.6063 21.9907 48.5383C22.0523 48.4172 21.9935 48.2735 21.8676 48.2256C19.9366 47.4931 18.0979 46.6 16.3292 45.5858C16.1893 45.5041 16.1781 45.304 16.3068 45.2082C16.679 44.9293 17.0513 44.6391 17.4067 44.3461C17.471 44.2926 17.5606 44.2813 17.6362 44.3151C29.2558 49.6202 41.8354 49.6202 53.3179 44.3151C53.3935 44.2785 53.4831 44.2898 53.5502 44.3433C53.9057 44.6363 54.2779 44.9293 54.6529 45.2082C54.7816 45.304 54.7732 45.5041 54.6333 45.5858C52.8646 46.6197 51.0259 47.4931 49.0921 48.2228C48.9662 48.2707 48.9102 48.4172 48.9718 48.5383C50.038 50.6034 51.2554 52.5699 52.5959 54.435C52.6519 54.5139 52.7526 54.5477 52.845 54.5195C58.6464 52.7249 64.529 50.0174 70.6019 45.5576C70.6551 45.5182 70.6887 45.459 70.6943 45.3942C72.1747 30.0791 68.2147 16.7757 60.1968 4.9823C60.1772 4.9429 60.1437 4.9147 60.1045 4.8978ZM23.7259 37.3253C20.2276 37.3253 17.3451 34.1136 17.3451 30.1693C17.3451 26.225 20.1717 23.0133 23.7259 23.0133C27.308 23.0133 30.1626 26.2532 30.1066 30.1693C30.1066 34.1136 27.28 37.3253 23.7259 37.3253ZM47.3178 37.3253C43.8196 37.3253 40.9371 34.1136 40.9371 30.1693C40.9371 26.225 43.7636 23.0133 47.3178 23.0133C50.9 23.0133 53.7545 26.2532 53.6986 30.1693C53.6986 34.1136 50.9 37.3253 47.3178 37.3253Z" />
                                </g>
                                <defs>
                                    <clipPath id="clip0">
                                        <rect width="71" height="55" fill="white"/>
                                    </clipPath>
                                </defs>
                            </svg>
                        </a>
                        <a href="https://t.me/XDAG_Community" target="_blank">
                            <i class="fa fa-telegram" aria-hidden="true"></i>
                        </a>
<!--                        <a  target="_blank"  data-toggle="modal" data-target="#qq">-->
<!--                            <i class="fa fa-qq" aria-hidden="true"></i>-->
<!--                        </a>-->
                        <a href="https://twitter.com/XDAG_Community" target="_blank">
                            <i class="fa fa-twitter" aria-hidden="true"></i>
                        </a>
                        <a href="https://www.reddit.com/r/xdag/" target="_blank">
                            <i class="fa fa-reddit-alien" aria-hidden="true"></i>
                        </a>
                        <a href="https://github.com/orgs/XDagger" target="_blank">
                            <i class="fa fa-github" aria-hidden="true"></i>
                        </a>

                        <a href="https://www.linkedin.com/company/xdag/" target="_blank">
                            <i class="fa fa-linkedin" aria-hidden="true"></i>
                        </a>
                        <a href="https://www.facebook.com/XDAG.Dagger.Community/" target="_blank">
                            <i class="fa fa-facebook-official" aria-hidden="true"></i>
                        </a>
<!--                        <a target="_blank"  data-toggle="modal" data-target="#weibo">-->
<!--                            <i class="fa fa-weibo" aria-hidden="true"></i>-->
<!--                        </a>-->
<!--                        <a href="https://tieba.baidu.com/f?kw=xdag&fr=ala0&tpl=5" target="_blank">-->
<!--                            <img src="/assets/images/tieba.png" alt="">-->
<!--                        </a>-->

<!--                        <a  target="_blank"  data-toggle="modal" data-target="#wechat">-->
<!--                            <i class="fa fa-wechat" aria-hidden="true"></i>-->
<!--                        </a>-->

                    </div>
                </div>
            </div>
            <div class="row links">
                <div class="col-md-2">Friends links：</div>
                <div class="col-md-10">
                        <a href="https://www.coinbase.com/price/xdag" target="_blank" >Coinbase</a>
<!--                       <a href="http://walletinvestor.com/currency/xdag" target="_blank" >Walletinvestor</a>-->
                        <a href="https://coinmarketcap.com/currencies/xdag/" target="_blank" >CMC</a>
                        <a href="https://coinpaprika.com/fr/coin/xdag-dagger/" target="_blank" >Coinpaprika</a>
                       <a href="https://github.com/xdagui" target="_blank" >XDAGUI</a>
<!--                       <a href="https://www.livecoinwatch.com/price/Dagger-XDAG" target="_blank" >LiveCoinWatch</a>-->
<!--                       <a href="https://www.coinlore.com/coin/dagger" target="_blank" >CoinLore</a>-->
                       <a href="https://www.coingecko.com/en/coins/dagger" target="_blank" >Coingecko</a>
                       <a href="https://whattomine.com/coins/350-xdag-randomx" target="_blank" >WhatToMine</a>
                       <a href="https://miningpoolstats.stream/dagger" target="_blank" >Mining Pool Stats</a>
                       <a href="http://minerbox.witplex.com/" target="_blank" >MinerBox</a>
                       <a href="https://www.coinlore.com/coin/dagger" target="_blank" >CoinLore</a>
                       <a href="https://web3camp.us/" target="_blank" >Web3Camp</a>
<!--                       <a href="https://blockspot.io/coin/dagger" target="_blank" >BlockSpot</a>-->

                </div>
            </div>
        </div>
    </div>
</section>

<script src="/assets/js/jquery-3.4.1.min.js"></script>

<script src="/assets/js/popper.min.js"></script>

<script src="/assets/js/bootstrap.js"></script>

<script src="/assets/js/main.js"></script>


</body>

</html>
